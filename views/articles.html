<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Articles - Cultural Community</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/animations.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
</head>
<body>
    <header class="header" id="header">
        <nav class="nav-container">
            <ul class="nav-menu" id="nav-menu">
                <li><a href="/" data-i18n="home">Home</a></li>
                <li><a href="/about" data-i18n="about">About</a></li>
                <li><a href="/culture" data-i18n="culture">Culture</a></li>
                <li><a href="/articles" class="active" data-i18n="articles">Articles</a></li>
                <li><a href="/members" data-i18n="members">Members</a></li>
                <li><a href="/events" data-i18n="events">Events</a></li>
                <li><a href="/contact" data-i18n="contact">Contact</a></li>
            </ul>
            <div class="auth-buttons">
                <div class="dropdown">
                    <button class="btn btn-icon dropdown-toggle" onclick="toggleDropdown()">‚ãÆ</button>
                    <div class="dropdown-menu" id="dropdown-menu">
                        <a href="/login" data-i18n="login">Login</a>
                        <a href="/register" data-i18n="join">Join</a>
                    </div>
                </div>
                <button id="lang-btn" class="btn btn-icon" onclick="toggleLang()" title="Change Language">üåç</button>
            </div>
        </nav>
    </header>

    <main class="container" style="margin-top: 6rem;">
        <section class="section">
            <h1 class="section-title" data-i18n="articles">Articles</h1>
            <p style="text-align: center; color: var(--text-light); font-size: 1.1rem; margin-bottom: 3rem;" data-i18n="articlesDesc">
                Explore our collection of articles about culture, traditions, history, and community stories.
            </p>

            <!-- <div class="search-filter">
                <div class="filter-row">
                    <div class="filter-group">
                        <input type="text" id="search" class="form-control" placeholder="Search articles...">
                    </div>
                    <div class="filter-group">
                        <select id="category-filter" class="form-control filter-select">
                            <option value="">All Categories</option>
                            <option value="history">History</option>
                            <option value="culture">Culture</option>
                            <option value="tradition">Tradition</option>
                            <option value="festival">Festival</option>
                            <option value="food">Food</option>
                            <option value="language">Language</option>
                        </select>
                    </div>
                </div>
            </div> -->

            <div id="articles-container" class="card-grid">
                <div class="spinner"></div>
            </div>
            
            <div id="pagination" style="display: flex; justify-content: center; gap: 0.5rem; margin-top: 2rem;"></div>
        </section>

        <section class="section pattern-bg" style="padding: 3rem; border-radius: 15px; text-align: center;">
            <h2 class="section-title" data-i18n="postYourArticle" style="color: white;">Post Your Article</h2>
            <p data-i18n="postYourArticleDesc" style="color: white; font-size: 1.2rem; margin-bottom: 2rem;">
                Have a story to share? Submit your articles about culture, traditions, and community experiences.
            </p>
            <a href="/submit-article" class="btn btn-primary" data-i18n="submitArticle" style="font-size: 1.1rem; padding: 1rem 2rem;">Submit Article</a>
        </section>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-grid">
                <div class="footer-section">
                    <h3 data-i18n="about">About</h3>
                    <p data-i18n="footerAboutDesc">Preserving our cultural heritage and connecting community members worldwide.</p>
                    <p data-i18n="footerConnectDesc" style="margin-top: 1rem;">Join our community and stay updated with events and news.</p>
                    <a href="/register" class="btn btn-outline" data-i18n="join" style="margin-top: 1rem; display: inline-block; color: white; border-color: white;">Join</a>
                </div>
                <div class="footer-section">
                    <h3 data-i18n="footerQuickLinks">Quick Links</h3>
                    <ul class="footer-links">
                        <li><a href="/about" data-i18n="about">About</a></li>
                        <li><a href="/culture" data-i18n="culture">Culture</a></li>
                        <li><a href="/articles" data-i18n="articles">Articles</a></li>
                        <li><a href="/members" data-i18n="members">Members</a></li>
                        <li><a href="/events" data-i18n="events">Events</a></li>
                        <li><a href="/contact" data-i18n="contact">Contact</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 <span data-i18n="footerRights">Tajpuriya Samaj. All rights reserved.</span></p>
                <p><span data-i18n="footerDeveloper">Developed by</span> <a href="https://devtaj.github.io/dev/" target="_blank">Dev Tajpuriya</a></p>
            </div>
        </div>
    </footer>

    <script src="/js/i18n-data.js"></script>
    <script src="/js/translations.js"></script>
    <script src="/js/effects.js"></script>
    <script src="/js/auth-nav.js"></script>
    <script>
function toggleDropdown() {
    document.getElementById('dropdown-menu').classList.toggle('show');
}

window.onclick = function(event) {
    if (!event.target.matches('.dropdown-toggle')) {
        const dropdowns = document.getElementsByClassName('dropdown-menu');
        for (let i = 0; i < dropdowns.length; i++) {
            dropdowns[i].classList.remove('show');
        }
    }
}

let allArticles = [];
const userData = JSON.parse(localStorage.getItem('user') || 'null');
const POSTS_PER_PAGE = 4;
let currentPage = 1;

document.addEventListener('DOMContentLoaded', async () => {
    try {
        const response = await fetch('/api/posts');
        allArticles = await response.json();
        console.log('Loaded articles:', allArticles);
        displayArticles(currentPage);
        renderPagination();
    } catch (error) {
        console.error('Error loading articles:', error);
        document.getElementById('articles-container').innerHTML = '<p style="text-align: center; color: var(--text-light);">Unable to load articles.</p>';
    }
});

function displayArticles(page) {
    const container = document.getElementById('articles-container');
    
    if (allArticles.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: var(--text-light);">No articles found.</p>';
        return;
    }
    
    const startIndex = (page - 1) * POSTS_PER_PAGE;
    const endIndex = startIndex + POSTS_PER_PAGE;
    const articlesToShow = allArticles.slice(startIndex, endIndex);
    
    container.innerHTML = articlesToShow.map(article => `
        <div class="card">
            ${article.image ? `<img src="${article.image}" alt="${article.title}" class="card-image">` : ''}
            <div class="card-content">
                <span style="display: inline-block; padding: 0.3rem 0.8rem; background: var(--primary-color); color: white; border-radius: 15px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; margin-bottom: 0.8rem;">
                    ${article.category}
                </span>
                <h3 class="card-title">${article.title}</h3>
                <p class="card-text">${article.excerpt}</p>
                <div style="margin-top: 1rem;">
                    <small style="color: var(--text-light);">By ${article.author.name}</small>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 1rem; gap: 0.5rem;">
                    <div style="display: flex; gap: 0.5rem;">
                        <button onclick="likeArticle('${article._id}')" class="btn btn-outline" style="padding: 0.4rem 0.8rem; font-size: 0.85rem;" ${!userData ? 'disabled title="Login to like"' : ''}>
                            üëç <span id="likes-${article._id}">${article.likes?.length || 0}</span>
                        </button>
                        <button onclick="dislikeArticle('${article._id}')" class="btn btn-outline" style="padding: 0.4rem 0.8rem; font-size: 0.85rem;" ${!userData ? 'disabled title="Login to dislike"' : ''}>
                            üëé <span id="dislikes-${article._id}">${article.dislikes?.length || 0}</span>
                        </button>
                    </div>
                    <button onclick="readMore('${article._id}')" class="btn btn-primary" style="padding: 0.4rem 1rem; font-size: 0.85rem;">
                        Read More
                    </button>
                </div>
            </div>
        </div>
    `).join('');
}

async function likeArticle(postId) {
    if (!userData) {
        alert('Please login to like articles');
        return;
    }
    try {
        const response = await fetch(`/api/posts/${postId}/like`, {
            method: 'PUT',
            credentials: 'include'
        });
        const data = await response.json();
        document.getElementById(`likes-${postId}`).textContent = data.likes;
        document.getElementById(`dislikes-${postId}`).textContent = data.dislikes;
    } catch (error) {
        console.error('Error liking article:', error);
    }
}

async function dislikeArticle(postId) {
    if (!userData) {
        alert('Please login to dislike articles');
        return;
    }
    try {
        const response = await fetch(`/api/posts/${postId}/dislike`, {
            method: 'PUT',
            credentials: 'include'
        });
        const data = await response.json();
        document.getElementById(`likes-${postId}`).textContent = data.likes;
        document.getElementById(`dislikes-${postId}`).textContent = data.dislikes;
    } catch (error) {
        console.error('Error disliking article:', error);
    }
}

function readMore(postId) {
    window.location.href = `/article/${postId}`;
}

function renderPagination() {
    const totalPages = Math.ceil(allArticles.length / POSTS_PER_PAGE);
    const paginationContainer = document.getElementById('pagination');
    
    if (totalPages <= 1) {
        paginationContainer.innerHTML = '';
        return;
    }
    
    let paginationHTML = '';
    
    for (let i = 1; i <= totalPages; i++) {
        paginationHTML += `
            <button onclick="goToPage(${i})" class="btn ${i === currentPage ? 'btn-primary' : 'btn-outline'}" style="padding: 0.5rem 1rem;">
                ${i}
            </button>
        `;
    }
    
    paginationContainer.innerHTML = paginationHTML;
}

function goToPage(page) {
    currentPage = page;
    displayArticles(page);
    renderPagination();
    window.scrollTo({ top: 0, behavior: 'smooth' });
}
    </script>
</body>
</html>
