<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Members Directory - Cultural Community</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <header class="header" id="header">
        <nav class="nav-container">
            <ul class="nav-menu" id="nav-menu">
                <li><a href="/" data-i18n="home">Home</a></li>
                <li><a href="/about" data-i18n="about">About</a></li>
                <li><a href="/culture" data-i18n="culture">Culture</a></li>
                <li><a href="/articles" data-i18n="articles">Articles</a></li>
                <li><a href="/members" class="active" data-i18n="members">Members</a></li>
                <li><a href="/events" data-i18n="events">Events</a></li>
                <li><a href="/contact" data-i18n="contact">Contact</a></li>
            </ul>
            <div class="auth-buttons">
                <div class="dropdown">
                    <button class="btn btn-icon dropdown-toggle" onclick="toggleDropdown()">‚ãÆ</button>
                    <div class="dropdown-menu" id="dropdown-menu">
                        <a href="/login" data-i18n="login">Login</a>
                        <a href="/register" data-i18n="join">Join</a>
                    </div>
                </div>
                <button id="lang-btn" class="btn btn-icon" onclick="toggleLang()" title="Change Language">üåç</button>
            </div>
        </nav>
    </header>

    <main class="container">
        <section class="section">
            <h1 class="section-title" data-i18n="membersDirectory">Members Directory</h1>
            
            <div class="admin-stats">
                <div class="stat-card">
                    <div class="stat-number" id="total-members">0</div>
                    <div class="stat-label" data-i18n="totalMembers">Total Members</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="board-members">${boardMembers.length}</div>
                    <div class="stat-label" data-i18n="boardMembers">Board Members</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="general-members">0</div>
                    <div class="stat-label" data-i18n="generalMembers">General Members</div>
                </div>
            </div>
        </section>

        <section class="section">
            <h2 class="section-title" data-i18n="boardMembers">Board Members</h2>
            <div id="board-members-container" class="member-grid">
                <div class="spinner"></div>
            </div>
        </section>

        <section class="section">
            <h2 class="section-title" data-i18n="generalMembers">General Members</h2>
            
            <div class="search-filter">
                <div class="filter-row">
                    <div class="filter-group">
                        <label for="search" data-i18n="searchMembers">Search Members:</label>
                        <input type="text" id="search" class="form-control" data-i18n-placeholder="searchPlaceholder" placeholder="Search by name or profession...">
                    </div>
                    <div class="filter-group">
                        <label for="profession-filter" data-i18n="professionLabel">Profession:</label>
                        <select id="profession-filter" class="form-control filter-select">
                            <option value="" data-i18n="allProfessions">All Professions</option>
                            <option value="doctor" data-i18n="doctor">Doctor</option>
                            <option value="engineer" data-i18n="engineer">Engineer</option>
                            <option value="teacher" data-i18n="teacher">Teacher</option>
                            <option value="business" data-i18n="business">Business</option>
                            <option value="lawyer" data-i18n="lawyer">Lawyer</option>
                            <option value="student" data-i18n="student">Student</option>
                            <option value="other" data-i18n="other">Other</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="city-filter" data-i18n="cityLabel">City:</label>
                        <select id="city-filter" class="form-control filter-select">
                            <option value="" data-i18n="allCities">All Cities</option>
                            <option value="mumbai" data-i18n="mumbai">Mumbai</option>
                            <option value="delhi" data-i18n="delhi">Delhi</option>
                            <option value="bangalore" data-i18n="bangalore">Bangalore</option>
                            <option value="pune" data-i18n="pune">Pune</option>
                            <option value="hyderabad" data-i18n="hyderabad">Hyderabad</option>
                            <option value="chennai" data-i18n="chennai">Chennai</option>
                            <option value="kolkata" data-i18n="kolkata">Kolkata</option>
                            <option value="other" data-i18n="other">Other</option>
                        </select>
                    </div>
                </div>
            </div>
        </section>

        <section class="section">
            <div id="members-container" class="member-grid">
                <div class="spinner"></div>
            </div>
        </section>

        <section class="section pattern-bg" style="padding: 3rem; border-radius: 15px; text-align: center;">
            <h2 class="section-title" data-i18n="joinOurCommunityTitle" style="color: white;">Join Our Community</h2>
            <p data-i18n="connectWithMembers" style="color: white; font-size: 1.2rem; margin-bottom: 2rem;">
                Connect with fellow community members and be part of our growing network.
            </p>
            <a href="/register" class="btn btn-primary" data-i18n="registerNow" style="font-size: 1.1rem; padding: 1rem 2rem;">Register Now</a>
        </section>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-grid">
                <div class="footer-section">
                    <h3 data-i18n="about">About</h3>
                    <p data-i18n="footerAboutDesc">Preserving our cultural heritage and connecting community members worldwide.</p>
                    <p data-i18n="footerConnectDesc" style="margin-top: 1rem;">Join our community and stay updated with events and news.</p>
                    <a href="/register" class="btn btn-outline" data-i18n="join" style="margin-top: 1rem; display: inline-block; color: white; border-color: white;">Join</a>
                </div>
                <div class="footer-section">
                    <h3 data-i18n="footerQuickLinks">Quick Links</h3>
                    <ul class="footer-links">
                        <li><a href="/about" data-i18n="about">About</a></li>
                        <li><a href="/culture" data-i18n="culture">Culture</a></li>
                        <li><a href="/articles" data-i18n="articles">Articles</a></li>
                        <li><a href="/members" data-i18n="members">Members</a></li>
                        <li><a href="/events" data-i18n="events">Events</a></li>
                        <li><a href="/contact" data-i18n="contact">Contact</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 <span data-i18n="footerRights">Tajpuriya Samaj. All rights reserved.</span></p>
                <p><span data-i18n="footerDeveloper">Developed by</span> <a href="https://devtaj.github.io/dev/" target="_blank">Dev Tajpuriya</a></p>
            </div>
        </div>
    </footer>

    <script src="/js/i18n-data.js"></script>
    <script src="/js/translations.js"></script>
    <script src="/js/effects.js"></script>
    <script src="/js/auth-nav.js"></script>
    <script src="/js/board-members.js"></script>
    <script src="/js/main.js"></script>
    <script>
function toggleDropdown() {
    document.getElementById('dropdown-menu').classList.toggle('show');
}
window.onclick = function(event) {
    if (!event.target.matches('.dropdown-toggle')) {
        const dropdowns = document.getElementsByClassName('dropdown-menu');
        for (let i = 0; i < dropdowns.length; i++) {
            dropdowns[i].classList.remove('show');
        }
    }
}

// Load members data
document.addEventListener('DOMContentLoaded', async () => {
    try {
        // Display board members from static data
        const boardContainer = document.getElementById('board-members-container');
        boardContainer.innerHTML = boardMembers.map(member => `
            <div class="member-card">
                <img src="${member.photo}" 
                     alt="${member.name}" class="member-avatar"
                     onerror="this.src='/images/default-avatar.png'">
                <h3 class="member-name">${member.name}</h3>
                <p class="member-position" style="color: var(--primary-color); font-weight: 600; margin-bottom: 0.5rem;">${member.position}</p>
                <p class="member-profession">${member.qualification}</p>
                <p class="member-location">${member.location}</p>
            </div>
        `).join('');
        
        // Load general members from API (registered users)
        const response = await fetch('/api/auth/test-users');
        const data = await response.json();
        const allMembers = data.users || [];
        
        // Filter only approved members
        const approvedMembers = allMembers.filter(member => member.isApproved === true);
        
        // Update stats
        document.getElementById('total-members').textContent = approvedMembers.length + boardMembers.length;
        document.getElementById('general-members').textContent = approvedMembers.length;
        
        // Display general members
        displayGeneralMembers(approvedMembers);
        
        // Filter functionality
        const searchInput = document.getElementById('search');
        const professionFilter = document.getElementById('profession-filter');
        const cityFilter = document.getElementById('city-filter');
        
        function filterMembers() {
            const searchTerm = searchInput.value.toLowerCase();
            const profession = professionFilter.value.toLowerCase();
            const city = cityFilter.value.toLowerCase();
            
            const filtered = approvedMembers.filter(member => {
                const matchSearch = !searchTerm || 
                    member.name.toLowerCase().includes(searchTerm) ||
                    member.profession.toLowerCase().includes(searchTerm);
                const matchProfession = !profession || member.profession.toLowerCase().includes(profession);
                const matchCity = !city || member.address?.street?.toLowerCase().includes(city);
                
                return matchSearch && matchProfession && matchCity;
            });
            
            displayGeneralMembers(filtered);
        }
        
        searchInput.addEventListener('input', filterMembers);
        professionFilter.addEventListener('change', filterMembers);
        cityFilter.addEventListener('change', filterMembers);
        
    } catch (error) {
        console.error('Error loading members:', error);
        document.getElementById('members-container').innerHTML = '<p>Unable to load members.</p>';
    }
});

function displayGeneralMembers(members) {
    const container = document.getElementById('members-container');
    if (members.length === 0) {
        container.innerHTML = '<p>No members found.</p>';
        return;
    }
    container.innerHTML = members.map(member => `
        <div class="member-card">
            <img src="${member.profileImage || '/images/default-avatar.png'}" 
                 alt="${member.name}" class="member-avatar">
            <h3 class="member-name">${member.name}</h3>
            <p class="member-profession">${member.profession}</p>
            <p class="member-location">${member.address?.street || ''}</p>
        </div>
    `).join('');
}

// Handle placeholder translation
const searchInput = document.getElementById('search');
if (searchInput) {
    const updatePlaceholder = () => {
        const key = searchInput.getAttribute('data-i18n-placeholder');
        if (key && translationData[i18n.currentLang][key]) {
            searchInput.placeholder = translationData[i18n.currentLang][key];
        }
    };
    updatePlaceholder();
    const originalToggle = window.toggleLang;
    if (originalToggle) {
        window.toggleLang = function() {
            originalToggle();
            updatePlaceholder();
        };
    }
}
    </script>
</body>
</html>
